<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Crescent House - Duty Display</title>
    <script src="https.cdn.tailwindcss.com"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fde68a;
            background: -webkit-linear-gradient(135deg, #fef3c7 0%, #fde68a 50%, #fcd34d 100%);
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 50%, #fcd34d 100%);
        }
        
        #app {
            width: 100vw;
            height: 100vh;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            padding: 2vh 2vw;
            box-sizing: border-box;
        }
        
        .main-container {
            width: 100%;
            height: 100%;
            max-width: 1200px;
            max-height: 100%;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            flex-direction: column;
            box-sizing: border-box;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            -webkit-box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border-radius: 1.5rem;
            padding: 2vh;
            height: 100%;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            flex-direction: column;
            box-sizing: border-box;
            position: relative;
        }
        
        .header-section {
            -webkit-box-flex: 0;
            -webkit-flex: 0 1 auto;
            flex: 0 1 auto;
            text-align: center;
            margin-bottom: 1vh;
        }
        
        .content-section {
            -webkit-box-flex: 1;
            -webkit-flex: 1 1 auto;
            flex: 1 1 auto;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            flex-direction: column;
            -webkit-box-pack: start;
            -webkit-justify-content: flex-start;
            justify-content: flex-start;
            min-height: 0;
            overflow: hidden; 
        }
        
        .footer-section {
            -webkit-box-flex: 0;
            -webkit-flex: 0 1 auto;
            flex: 0 1 auto;
            margin-top: 0.5vh;
        }
        
        .logo-svg {
            position: absolute;
            top: 1.5vh;
            left: 1.5vw;
            width: min(25vh, 15vw);
            height: min(25vh, 15vw);
        }
        
        .shift-badge {
            background: #f59e0b;
            background: -webkit-linear-gradient(135deg, #f59e0b, #d97706);
            background: linear-gradient(135deg, #f59e0b, #d97706);
            display: -webkit-inline-box;
            display: -webkit-inline-flex;
            display: inline-flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            color: white;
            padding: 1vh 2vw;
            border-radius: 9999px;
            font-weight: 600;
        }
        
        .duty-card {
            background: #fffbeb;
            background: -webkit-linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 3px solid #f59e0b;
            border-radius: 1.5rem;
            padding: 1.8vh 2vw;
            text-align: center;
            margin-bottom: 0.5vh;
        }
        
        .next-duty-card {
            background: #ffffff;
            background: -webkit-linear-gradient(135deg, #ffffff 0%, #fefce8 100%);
            background: linear-gradient(135deg, #ffffff 0%, #fefce8 100%);
            border: 2px solid #fbbf24;
            border-radius: 1rem;
            padding: 1.2vh 2vw;
            text-align: center;
        }
        
        .oncall-card {
            background: #ffffff;
            background: -webkit-linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            border: 2px solid #fb923c;
            border-radius: 0.75rem;
            padding: 0.8vh 1vw;
            text-align: center;
            margin-top: 0.5vh;
        }
        
        .duty-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1vw;
        }
        
        .text-oncall-label { font-size: 2vh; color: #c2410c; font-weight: 600; }
        .text-oncall-name { font-size: 3.5vh; color: #9a3412; font-weight: bold; }
        
        .text-oncall-subtext {
            font-size: 1.8vh;
            color: #9a3412;
            line-height: 1.2;
        }
        
        .shift-time-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 0.75rem;
            padding: 1vh 1vw;
            text-align: center;
        }
        
        .crescent-icon {
            display: inline-block;
            -webkit-animation: float 3s ease-in-out infinite;
            animation: float 3s ease-in-out infinite;
        }
        
        @-webkit-keyframes float {
            0%, 100% { -webkit-transform: translateY(0px); transform: translateY(0px); }
            50% { -webkit-transform: translateY(-5px); transform: translateY(-5px); }
        }
        
        @keyframes float {
            0%, 100% { -webkit-transform: translateY(0px); transform: translateY(0px); }
            50% { -webkit-transform: translateY(-5px); transform: translateY(-5px); }
        }
        
        /* Responsive text sizes using vh units */
        .text-title { font-size: 5vh; font-weight: bold; color: #78350f; }
        .text-date { font-size: 2.5vh; color: #b45309; font-weight: 500; }
        .text-shift-label { font-size: 2.5vh; font-weight: 600; }
        .text-time { font-size: 2.5vh; color: #f59e0b; font-weight: 500; }
        
        .text-duty-label { font-size: 3.0vh; color: #78350f; font-weight: 600; }
        .text-duty-name { font-size: 7.0vh; color: #1c1917; font-weight: bold; }
        
        .text-next-label { font-size: 2.2vh; color: #b45309; font-weight: 600; }
        .text-next-shift { font-size: 1.6vh; color: #d97706; }
        .text-next-name { font-size: 4.2vh; color: #78350f; font-weight: bold; }
        
        .text-schedule-label { font-size: 1.8vh; color: #92400e; font-weight: 600; }
        .text-schedule-time { font-size: 1.6vh; color: #d97706; }
        .text-footer { font-size: 1.6vh; color: #d97706; }
        
        .icon-sm { font-size: 2.5vh; }
        .icon-md { font-size: 3vh; }
        .icon-lg { font-size: 4vh; }
        
        .flex-center {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
        }
        
        .gap-sm { gap: 1vh; }
        .gap-md { gap: 1.5vh; }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1vh;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        var GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTaV5LO0lckYcYAl-2NV3kut2k7TKxezMG5n7Kql2iTTtcg7Q9Lj_MfEgHlk8Y0pybHHkSLLojxmS7S/pub?output=csv';
        
        var shiftTimes = {
            day: { start: 8, end: 17, label: "Day Shift", icon: "‚òÄÔ∏è" },
            evening: { start: 17, end: 23, label: "Evening Shift", icon: "üåÖ" },
            overnight: { start: 23, end: 8, label: "Overnight Shift", icon: "üåô" }
        };

        var dutySchedule = [];
        var onCallSchedule = [];
        var libraryDutySchedule = [];
        var sportsHallDutySchedule = [];
        
        // === TIME SET TO LIVE ===
        var currentTime = new Date(); 
        
        var currentShift = '';
        var dutyPerson = '';
        var nextShift = '';
        var nextDutyPerson = '';
        var nextShiftTime = '';
        var onCallPerson = '';
        var libraryDutyPerson = '';
        var sportsHallDutyPerson = '';
        var weatherData = null;
        var isLoading = true;
        var errorMessage = '';

        // =============================================
        // === WEATHER FUNCTIONS ===
        // =============================================

        function loadWeather() {
            var lat = 51.674020;
            var lon = -1.289347;
            
            var weatherApiUrl = 'https://api.open-meteo.com/v1/forecast?latitude=' + lat + '&longitude=' + lon + '&current_weather=true';
            
            fetch(weatherApiUrl)
            .then(function(response) {
                if (!response.ok) throw new Error('Failed to fetch weather');
                return response.json();
            })
            .then(function(data) {
                if (data && data.current_weather) {
                    weatherData = {
                        temp: Math.round(data.current_weather.temperature),
                        code: data.current_weather.weathercode,
                        is_day: data.current_weather.is_day // 1 = day, 0 = night
                    };
                    render(); // Re-render with new weather data
                }
            })
            .catch(function(error) {
                console.error('Error loading weather:', error);
                weatherData = null; // Reset on error
            });
        }

        function getWeatherIcon(code, is_day) {
            switch (code) {
                case 0: // Clear sky
                    return is_day ? '‚òÄÔ∏è' : 'üåë';
                case 1: // Mainly clear
                    return is_day ? 'üå§Ô∏è' : '‚òÅÔ∏è';
                case 2: // Partly cloudy
                    return is_day ? 'üå•Ô∏è' : '‚òÅÔ∏è';
                case 3: // Overcast
                    return '‚òÅÔ∏è';
                case 45: case 48: // Fog
                    return 'üå´Ô∏è';
                case 51: case 53: case 55: // Drizzle
                    return 'üå¶Ô∏è';
                case 61: case 63: case 65: // Rain
                    return 'üåßÔ∏è';
                case 66: case 67: // Freezing Rain
                    return 'üåßÔ∏è';
                case 71: case 73: case 75: // Snow fall
                    return 'üå®Ô∏è';
                case 77: // Snow grains
                    return 'üå®Ô∏è';
                case 80: case 81: case 82: // Rain showers
                    return 'üåßÔ∏è';
                case 85: case 86: // Snow showers
                    return 'üå®Ô∏è';
                case 95: // Thunderstorm
                    return '‚õàÔ∏è';
                case 96: case 99: // Thunderstorm with hail
                    return '‚õàÔ∏è';
                default:
                    return 'üå°Ô∏è'; // Default/unknown
            }
        }

        // =============================================
        // === END OF WEATHER FUNCTIONS ===
        // =============================================

        function parseDate(dateString) {
            var parts = dateString.split('-');
            if (parts.length !== 3) return null;
            var year = parseInt(parts[0]);
            var month = parseInt(parts[1]) - 1;
            var day = parseInt(parts[2]);
            return new Date(year, month, day);
        }

        function isSameDate(date1, date2) {
            return date1.getFullYear() === date2.getFullYear() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getDate() === date2.getDate();
        }

        function parseCSV(csv) {
            var lines = csv.split('\n').filter(function(line) { return line.trim(); });
            var schedule = [];
            var onCall = [];
            var libraryDuty = [];
            var sportsHallDuty = [];
            
            for (var i = 1; i < lines.length; i++) {
                var line = lines[i].trim();
                if (!line) continue;
                
                var matches = line.match(/(".*?"|[^,]+)(?=\s*,|\s*$)/g);
                if (!matches || matches.length < 3) continue;
                
                var dateString = matches[0].replace(/^"|"$/g, '').trim();
                var shift = matches[1].replace(/^"|"$/g, '').trim().toLowerCase().replace(/\s+/g, '-');
                var name = matches[2].replace(/^"|"$/g, '').trim();
                var date = parseDate(dateString);
                
                if (date && shift === 'on-call') {
                    onCall.push({ date: date, name: name });
                } else if (date && shift === 'library') {
                    libraryDuty.push({ date: date, name: name });
                } else if (date && shift === 'sports-hall') {
                    sportsHallDuty.push({ date: date, name: name });
                } else if (date && (shift === 'day' || shift === 'evening' || shift === 'overnight')) {
                    schedule.push({ date: date, shift: shift, name: name });
                }
            }
            return { schedule: schedule, onCall: onCall, libraryDuty: libraryDuty, sportsHallDuty: sportsHallDuty };
        }

        function loadScheduleFromGoogleSheets() {
            if (GOOGLE_SHEET_URL === 'YOUR_GOOGLE_SHEET_CSV_URL_HERE') {
                errorMessage = 'Please configure Google Sheets URL';
                isLoading = false;
                render();
                return;
            }
            
            var timestamp = new Date().getTime();
            var urlWithTimestamp = GOOGLE_SHEET_URL + '&_=' + timestamp;
            var proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent(urlWithTimestamp);
            
            fetch(proxyUrl, {
                cache: 'no-store',
                headers: { 'Cache-Control': 'no-cache' }
            })
            .then(function(response) {
                if (!response.ok) throw new Error('Failed to fetch schedule');
                return response.text();
            })
            .then(function(csvText) {
                var parsed = parseCSV(csvText);
                dutySchedule = parsed.schedule;
                onCallSchedule = parsed.onCall;
                libraryDutySchedule = parsed.libraryDuty;
                sportsHallDutySchedule = parsed.sportsHallDuty;
                isLoading = false;
                errorMessage = '';
                updateDuty(currentTime);
                render();
            })
            .catch(function(error) {
                console.error('Error loading schedule:', error);
                errorMessage = 'Cannot load schedule. Check: 1) Sheet is published to web 2) URL is correct';
                isLoading = false;
                render();
            });
        }

        function getCurrentShift(date) {
            var hour = date.getHours();
            if (hour >= 8 && hour < 17) return 'day';
            if (hour >= 17 && hour < 23) return 'evening';
            return 'overnight';
        }

        function getNextShift(currentShift) {
            if (currentShift === 'day') return 'evening';
            if (currentShift === 'evening') return 'overnight';
            return 'day';
        }

        function getNextShiftDate(date, currentShift) {
            if (currentShift === 'overnight') {
                var tomorrow = new Date(date);
                tomorrow.setDate(tomorrow.getDate() + 1);
                return tomorrow;
            }
            return date;
        }

        function updateDuty(date) {
            var shift = getCurrentShift(date);
            currentShift = shift;
            
            var dayOfWeek = date.getDay(); // 0 = Sunday, 5 = Friday, 6 = Saturday
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var timeInMinutes = hours * 60 + minutes;
            
            var entry = dutySchedule.find(function(e) {
                return isSameDate(e.date, date) && e.shift === shift;
            });
            dutyPerson = entry ? entry.name : 'No duty assigned';

            nextShift = getNextShift(shift);
            var nextShiftDate = getNextShiftDate(date, shift);
            var nextEntry = dutySchedule.find(function(e) {
                return isSameDate(e.date, nextShiftDate) && e.shift === nextShift;
            });
            nextDutyPerson = nextEntry ? nextEntry.name : 'No duty assigned';
            nextShiftTime = shiftTimes[nextShift].label;
            
            var onCallEntry = onCallSchedule.find(function(e) {
                return isSameDate(e.date, date);
            });
            onCallPerson = onCallEntry ? onCallEntry.name : 'Not assigned';
            
            // Library: Closed Friday, Saturday (except 10am-11:30am), Sunday
            if (dayOfWeek === 5) {
                libraryDutyPerson = 'Closed';
            } else if (dayOfWeek === 6) {
                // Saturday: Show "Open" message *until* 11:30am (690 minutes)
                if (timeInMinutes > 690) { // After 11:30am
                    libraryDutyPerson = 'Closed';
                } else {
                    // Before and during opening time
                    var libraryEntry = libraryDutySchedule.find(function(e) {
                        return isSameDate(e.date, date);
                    });
                    if (libraryEntry && libraryEntry.name && libraryEntry.name !== '#N/A' && libraryEntry.name.trim() !== '') {
                        libraryDutyPerson = libraryEntry.name;
                    } else {
                        libraryDutyPerson = 'Open|10am to 11.30am';
                    }
                }
            } else if (dayOfWeek === 0) {
                libraryDutyPerson = 'Closed'; // Closed all day Sunday
            } else {
                var libraryEntry = libraryDutySchedule.find(function(e) {
                    return isSameDate(e.date, date);
                });
                libraryDutyPerson = libraryEntry ? libraryEntry.name : 'Not assigned';
            }
            
            // Sports Hall: Closed Sunday (except 2pm-4pm), Saturday (except 10am-11:30am)
            if (dayOfWeek === 6) {
                // Saturday: Show "Open" message *until* 11:30am (690 minutes)
                if (timeInMinutes > 690) { // After 11:30am
                    sportsHallDutyPerson = 'Closed';
                } else {
                    // Before and during opening time
                    var sportsHallEntry = sportsHallDutySchedule.find(function(e) {
                        return isSameDate(e.date, date);
                    });
                    if (sportsHallEntry && sportsHallEntry.name && sportsHallEntry.name !== '#N/A' && sportsHallEntry.name.trim() !== '') {
                        sportsHallDutyPerson = sportsHallEntry.name;
                    } else {
                        sportsHallDutyPerson = 'Open|10am to 11.30am';
                    }
                }
            } else if (dayOfWeek === 0) {
                // Sunday: Show "Open" message *until* 4pm (960 minutes)
                if (timeInMinutes > 960) { // After 4:00pm
                    sportsHallDutyPerson = 'Closed';
                } else {
                    // Before and during opening time
                    var sportsHallEntry = sportsHallDutySchedule.find(function(e) {
                        return isSameDate(e.date, date);
                    });
                    if (sportsHallEntry && sportsHallEntry.name && sportsHallEntry.name !== '#N/A' && sportsHallEntry.name.trim() !== '') {
                        sportsHallDutyPerson = sportsHallEntry.name;
                    } else {
                        sportsHallDutyPerson = 'Open|2pm - 4pm';
                    }
                }
            } else {
                var sportsHallEntry = sportsHallDutySchedule.find(function(e) {
                    return isSameDate(e.date, date);
                });
                sportsHallDutyPerson = sportsHallEntry ? sportsHallEntry.name : 'Not assigned';
            }
        }

        function formatDate(date) {
            var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            return days[date.getDay()] + ', ' + months[date.getMonth()] + ' ' + date.getDate();
        }

        function render() {
            var shiftInfo = shiftTimes[currentShift];
            var timeString = currentTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            var mainContent;
            
            if (isLoading) {
                mainContent = '<div class="duty-card"><div class="text-duty-label">Loading schedule...</div></div>';
            } else if (errorMessage) {
                mainContent = '<div class="duty-card"><div class="text-duty-label" style="color: #dc2626; margin-bottom: 1vh;">‚ö†Ô∏è ' + errorMessage + '</div><div class="text-next-shift">Check the Google Sheets URL configuration</div></div>';
            } else {
                
                // === WEATHER DISPLAY LOGIC ===
                var weatherDisplay = shiftInfo.icon;
                var weatherTemp = '';
                if (weatherData && weatherData.temp !== undefined) {
                    var weatherIcon = getWeatherIcon(weatherData.code, weatherData.is_day);
                    weatherDisplay = weatherIcon;
                    weatherTemp = ' ' + weatherData.temp + '¬∞C';
                }
                
                // === LOGIC FOR TWO-LINE DISPLAY ===
                var libraryDisplay;
                if (libraryDutyPerson.includes('|')) {
                    var parts = libraryDutyPerson.split('|');
                    libraryDisplay = '<div class="text-oncall-name">' + parts[0] + '</div>' +
                                     '<div class="text-oncall-subtext">' + parts[1] + '</div>';
                } else {
                    libraryDisplay = '<div class="text-oncall-name">' + libraryDutyPerson + '</div>';
                }

                var sportsHallDisplay;
                if (sportsHallDutyPerson.includes('|')) {
                    var parts = sportsHallDutyPerson.split('|');
                    sportsHallDisplay = '<div class="text-oncall-name">' + parts[0] + '</div>' +
                                        '<div class="text-oncall-subtext">' + parts[1] + '</div>';
                } else {
                    sportsHallDisplay = '<div class="text-oncall-name">' + sportsHallDutyPerson + '</div>';
                }
                // ===================================
                
                mainContent = '\
                    <div style="text-align: center; margin-bottom: 0.5vh;">\
                        <div class="shift-badge gap-sm" style="flex-direction: column; padding: 1.2vh 2.5vw;">\
                            <span style="font-size: 2.2vh;">' + weatherDisplay + weatherTemp + '</span>\
                            <span class="text-shift-label">' + shiftInfo.label + '</span>\
                        </div>\
                        <div class="text-time" style="margin-top: 0.5vh;">' + timeString + '</div>\
                    </div>\
                    <div class="duty-card">\
                        <div class="flex-center gap-md" style="margin-bottom: 1vh;">\
                            <span class="icon-lg">üë§</span>\
                            <span class="text-duty-label">Currently On Duty</span>\
                        </div>\
                        <div class="text-duty-name">' + dutyPerson + '</div>\
                    </div>\
                    <div class="next-duty-card">\
                        <div class="text-next-label">Coming Up Next</div>\
                        <div class="text-next-shift" style="margin: 0.3vh 0 0.5vh 0;">' + nextShiftTime + '</div>\
                        <div class="text-next-name">' + nextDutyPerson + '</div>\
                    </div>\
                    <div class="oncall-card">\
                        <div class="duty-grid">\
                            <div>\
                                <div class="flex-center gap-sm" style="margin-bottom: 0.2vh;">\
                                    <span class="icon-sm">üìû</span>\
                                    <span class="text-oncall-label">On-Call</span>\
                                </div>\
                                <div class="text-oncall-name">' + onCallPerson + '</div>\
                            </div>\
                            <div>\
                                <div class="flex-center gap-sm" style="margin-bottom: 0.2vh;">\
                                    <span class="icon-sm">üìö</span>\
                                    <span class="text-oncall-label">Library</span>\
                                </div>\
                                ' + libraryDisplay + '\
                            </div>\
                            <div>\
                                <div class="flex-center gap-sm" style="margin-bottom: 0.2vh;">\
                                    <span class="icon-sm">üèÄ</span>\
                                    <span class="text-oncall-label">Sports Hall</span>\
                                </div>\
                                ' + sportsHallDisplay + '\
                            </div>\
                        </div>\
                    </div>\
                ';
            }
            
            document.getElementById('app').innerHTML = '\
                <div class="main-container">\
                    <div class="card">\
                        <img src="https://raw.githubusercontent.com/markjohnson-design/rota/refs/heads/main/Crescent%20Wolves.svg" alt="Logo" class="logo-svg" />\
                        \
                        <div class="header-section">\
                            <h1 class="text-title"><span class="crescent-icon">üåô</span> Crescent House</h1>\
                            <div class="flex-center gap-sm" style="margin-top: 0.5vh;">\
                                <span class="icon-sm">üìÖ</span>\
                                <span class="text-date">' + formatDate(currentTime) + '</span>\
                            </div>\
                        </div>\
                        <div class="content-section">\
                            ' + mainContent + '\
                        </div>\
                        <div class="footer-section">\
                            <div class="grid-3">\
                                <div class="shift-time-box">\
                                    <div class="flex-center gap-sm" style="margin-bottom: 0.5vh;">\
                                        <span class="icon-sm">‚òÄÔ∏è</span>\
                                        <span class="text-schedule-label">Day</span>\
                                    </div>\
                                    <div class="text-schedule-time">8am - 5pm</div>\
                                </div>\
                                <div class="shift-time-box">\
                                    <div class="flex-center gap-sm" style="margin-bottom: 0.5vh;">\
                                        <span class="icon-sm">üåÖ</span>\
                                        <span class="text-schedule-label">Evening</span>\
                                    </div>\
                                    <div class="text-schedule-time">5pm - 11pm</div>\
                                </div>\
                                <div class="shift-time-box">\
                                    <div class="flex-center gap-sm" style="margin-bottom: 0.5vh;">\
                                        <span class="icon-sm">üåô</span>\
                                        <span class="text-schedule-label">Overnight</span>\
                                    </div>\
                                    <div class="text-schedule-time">11pm - 8am</div>\
                                </div>\
                            </div>\
                            <div style="text-align: center; margin-top: 1.5vh;">\
                                <p class="text-footer">Display updates every minute ‚Ä¢ Schedule reloads every 5 minutes</p>\
                            </div>\
                        </div>\
                    </div>\
                </div>\
            ';
        }

        function update() {
            // === CLOCK IS LIVE ===
            currentTime = new Date(); 
            
            if (!isLoading && !errorMessage) {
                updateDuty(currentTime);
            }
            render();
        }

        render();
        loadScheduleFromGoogleSheets();
        loadWeather(); 
        
        // === CLOCK UPDATE IS LIVE ===
        setInterval(update, 60000); 
        
        setInterval(loadScheduleFromGoogleSheets, 300000);
        setInterval(loadWeather, 600000); 
    </script>
</body>
</html>
